# ğŸ” Kt-pattern - Kotlin Pattern Matching DSL

Kotlinì—ì„œ êµ¬ì¡°ì  ë¶„ê¸°ì™€ íƒ€ì… ê¸°ë°˜ ì¡°ê±´ì„ ë” ì„ ì–¸ì ì´ê³  ì§ê´€ì ìœ¼ë¡œ ë‹¤ë£° ìˆ˜ ìˆëŠ” íŒ¨í„´ ë§¤ì¹­ DSLì…ë‹ˆë‹¤.

í‘œí˜„ë ¥ì´ ì œí•œì ì¸ when ë¬¸ì„ ë³´ì™„í•˜ê³ ì í–ˆìœ¼ë©°, í˜„ì¬ Kotlin ìƒíƒœê³„ì— ë§ˆë•…í•œ ëŒ€ì•ˆì´ ì—†ì–´ ì§ì ‘ êµ¬í˜„í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## âœ¨ Motivation

Kotlinì€ ê¸°ë³¸ì ìœ¼ë¡œ when ë¬¸ì„ í†µí•´ ì •ì  íƒ€ì… ê¸°ë°˜ ë¶„ê¸°ëŠ” ì§€ì›í•˜ì§€ë§Œ, ë‹¤ìŒê³¼ ê°™ì€ í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤:

ëŸ°íƒ€ì„ íƒ€ì… ê¸°ë°˜ ë¶„ê¸°ë¥¼ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•˜ê¸° ì–´ë µê³ ,

ê°’ ê¸°ë°˜ ë§¤ì¹­ì´ë‚˜ ë³µí•© ì¡°ê±´(type + predicate)ì„ í‘œí˜„í•˜ê¸° ìœ„í•´ì„  is, ==, &&, if ë“±ì„ ì–½ì–´ ì¨ì•¼ í•˜ë©°,

sealed classë¥¼ ì‚¬ìš©í•´ë„ ì¤‘ì²© ë¶„ê¸°ì™€ ë³µì¡í•œ ì¡°ê±´ë¬¸ìœ¼ë¡œ ì¸í•´ ê°€ë…ì„±ì´ ë–¨ì–´ì§€ê¸° ì‰½ìŠµë‹ˆë‹¤.

ì¦‰, Kotlinì˜ when ë¬¸ì€ í‘œí˜„ë ¥ì´ ë¶€ì¡±í•œ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´:

- íƒ€ì…ê³¼ ê°’, êµ¬ì¡°ë¥¼ ë™ì‹œì— ë§¤ì¹­í•˜ê³  ì‹¶ì„ ë•Œ

- ë³µì¡í•œ ì¡°ê±´ë¬¸ì„ ì„ ì–¸ì ìœ¼ë¡œ ë¶„ê¸°í•˜ê³  ì‹¶ì„ ë•Œ

- ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ê°€ ì¤‘ìš”í•œ DSL êµ¬ì¡°ê°€ í•„ìš”í•  ë•Œ

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

- Kotlin 1.9.x
- Gradle Kotlin DSL
- JUnit5 (í…ŒìŠ¤íŠ¸)

---

## Installation

To use `Kt-pattern` in your project, add the following dependency to your `build.gradle`:

```gradle
dependencies {
    implementation "com.ktpattern:kt-pattern:1.0.0"
}
```

---

## ğŸš€ Features
| ê¸°ëŠ¥ | ì˜ˆì œ |
|------|------|
| **íƒ€ì… ê¸°ë°˜ ë§¤ì¹­ (Type Matching)** | `whenType<String> { "It's a String: $it" }` |
| **ê°’ ê¸°ë°˜ ë§¤ì¹­ (Value Matching)** | `whenValue(123) { "Matched value: $it" }` |
| **êµ¬ì¡° ë¶„í•´ ë§¤ì¹­ (Destructuring Matching)** | `caseOf<Person> { "Person: ${it.name}" }` |
| **ì¡°ê±´ë¶€ ë§¤ì¹­ (Predicate DSL)** | `caseOf<Box<Int>>({ it.value > 10 }) { "Boxed: ${it.value}" }` |
| **ìŠ¤ë§ˆíŠ¸ ìºìŠ¤íŠ¸ ì—°ê³„ (Smart Cast)** | `caseOf<Dog>({ it.age < 10 }) { "Young dog: ${it.name}" }` |
| **Sealed class ì§€ì›** | `whenType<Animal> { "Animal: $it" }` |
| **ì»¤ìŠ¤í…€ íŒ¨í„´ ì •ì˜ (Custom Pattern)** | `case(customPattern) { "Matched custom" }` |
| **ë§¤ì¹­ëœ ê°’ DSL actionì— ì „ë‹¬** | `caseOf<Person> { person -> "Hi ${person.name}" }` |
| **ë§¤ì¹­ ê³¼ì • ìŠ¤ëƒ…ìƒ· ê¸°ë¡ (Snapshot Logging)** | `match(input, snapshotBinder = binder) { ... }` |

> ğŸ“Œ Snapshot ê¸°ëŠ¥ì€ ë§¤ì¹­ ì‹¤í–‰ ì¤‘ ì…ë ¥ê°’, íŒ¨í„´, ë§¤ì¹­ ìƒíƒœ(Matched/NotMatched ë“±)ë¥¼ ê¸°ë¡í•˜ë©°  
> `SnapshotBinder.getAll()`ì„ í†µí•´ ì „ì²´ í‰ê°€ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ§  ëª¨ë“ˆ ì„¤ê³„ ëª©í‘œ ë° êµ¬ì„±

ë³¸ í”„ë¡œì íŠ¸ëŠ” ì„ ì–¸í˜• íŒ¨í„´ ë§¤ì¹­ DSLì˜ **í‘œí˜„ë ¥, ì¬ì‚¬ìš©ì„±, í™•ì¥ì„±**ì„ ë†’ì´ê¸° ìœ„í•´  
ë‹¤ìŒê³¼ ê°™ì€ ì„¤ê³„ ì›ì¹™ì„ ê¸°ë°˜ìœ¼ë¡œ ë©€í‹°ëª¨ë“ˆ ì•„í‚¤í…ì²˜ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.

### 1. êµ¬ì¡° ë¶„ë¦¬ (ê¸°ëŠ¥ ì±…ì„ë³„ ëª¨ë“ˆí™”)

- í•µì‹¬ ì¶”ìƒí™”(core), evaluator ë° ì‹¤í–‰ ë¡œì§(runtime), DSL í˜¸ì¶œë¶€(dsl) ë“±ì„ ëª¨ë“ˆë¡œ ë¶„ë¦¬í•˜ì—¬  
  ê° ì±…ì„ì„ ëª…í™•íˆ í•©ë‹ˆë‹¤.
- ì˜ì¡´ì„± ë°©í–¥ì€ ë‹¨ë°©í–¥ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, í•˜ìœ„ ëª¨ë“ˆì— ëŒ€í•œ ì§ì ‘ ì ‘ê·¼ ì—†ì´ ë™ì‘í•©ë‹ˆë‹¤.

> ì˜ˆ: `dsl-dsl` â†’ `dsl-runtime` â†’ `dsl-core`

### 2. ì‹¤í–‰ ë¶„ë¦¬ (main() ê¸°ë°˜ ì‹¤í–‰ ì˜ˆì œ)

- ë³„ë„ì˜ ì‹¤í–‰ í™˜ê²½ ëª¨ë“ˆì€ ì¡´ì¬í•˜ì§€ ì•Šì§€ë§Œ, `examples` ëª¨ë“ˆì„ í†µí•´ DSLì˜ ì‚¬ìš© íë¦„ì„ ì‹¤ì œ ì½”ë“œë¡œ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì´ëŠ” ë„ë©”ì¸ ë¡œì§ê³¼ ì‹¤í–‰ íë¦„ì„ ë¶„ë¦¬í•˜ì—¬ êµ¬ì¡°ì  ìœ ì—°ì„±ì„ ë†’ì´ëŠ” ê¸°ë°˜ì´ ë©ë‹ˆë‹¤.

### 3. ë‚´ë¶€ ìº¡ìŠí™” ë° êµì²´ ê°€ëŠ¥í•œ êµ¬ì¡°

- ê° ëª¨ë“ˆì€ ë™ì¼í•œ íŒ¨í‚¤ì§€ ë„¤ì´ë°ì„ ë”°ë¥´ë˜, `internal` í‚¤ì›Œë“œë¥¼ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ ë…¸ì¶œì„ ë°©ì§€í•©ë‹ˆë‹¤.
- evaluator ë“±ì€ `ServiceLoader`ë¥¼ í†µí•´ ëŸ°íƒ€ì„ ì‹œì ì—ì„œ êµì²´ ê°€ëŠ¥í•˜ë©°, ì™¸ë¶€ í™˜ê²½ì— ë”°ë¼ êµ¬í˜„ì²´ë§Œ ë°”ê¿”ë„ ì „ì²´ DSLì€ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.

ğŸ“Œ í•„ìš” ì‹œ web, batch, cli ë“± ë‹¤ì–‘í•œ ì‹¤í–‰ í™˜ê²½ìœ¼ë¡œ DSLì„ í™•ì¥ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.  
í˜„ì¬ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ìì²´ì˜ ë³¸ì§ˆì— ì¶©ì‹¤í•˜ê²Œ ì˜ì¡´ì„±ì„ ìµœì†Œí™”í•˜ë ¤ í•˜ë©°, ë‚´ë¶€ ê¸°ëŠ¥ì˜ ì™„ì„±ë„ë¥¼ ë†’ì´ëŠ” ë°ì— ì´ˆì ì„ ë‘ê³  ìˆìŠµë‹ˆë‹¤.

---

## ğŸ§© ë©€í‹°ëª¨ë“ˆ êµ¬ì„±

| ëª¨ë“ˆëª…        | ì„¤ëª…                                                           |
| ------------- |--------------------------------------------------------------|
| `dsl-core`    | í•µì‹¬ êµ¬ì¡° ë° íŒ¨í„´ ì •ì˜ (`Pattern`, `MatchResult`, `PatternEvaluator`) |
| `dsl-runtime` | í‰ê°€ ë¡œì§ êµ¬í˜„ (`DefaultPatternEvaluator`, `Snapshot`)             |
| `dsl-dsl`     | ì‚¬ìš©ì DSL í˜¸ì¶œë¶€ (`match`, `case`, `MatchBuilder`)                |
| `dsl-test`    | í…ŒìŠ¤íŠ¸ ìœ í‹¸ ë° ë„êµ¬                                                  |
| `examples`    | DSL ì‚¬ìš© ì˜ˆì‹œë¥¼ ë‹´ì€ ì‹¤í–‰ ê°€ëŠ¥ ë°ëª¨ ì½”ë“œ (`main()`, ìƒ˜í”Œ ë§¤ì¹­ ë¡œì§)               |

---

## ğŸ§± Architecture Overview

ì‚¬ìš©ì DSL í˜¸ì¶œ  
â–¼  
**MatchBuilder** (ì‚¬ìš©ì ì •ì˜ íŒ¨í„´ + ì•¡ì…˜ ìˆ˜ì§‘)  
â–¼  
**MatchContext** (íŒ¨í„´ ëª©ë¡ + ì…ë ¥ê°’ ë°”ì¸ë”©)  
â–¼  
**PatternEvaluator** (ì¬ê·€ì  í‰ê°€ ë¡œì§)  
â”œâ”€â”€ TypePattern  
â”œâ”€â”€ ValuePattern  
â”œâ”€â”€ DestructurePattern  
â”œâ”€â”€ PredicateCondition  
â””â”€â”€ (ì„ íƒì ) Snapshot ê¸°ë¡

â–¼  
**PatternMatchResult** (Success / Failure / Bindings)

---

```mermaid
graph TD
    User["ğŸ‘¤ DSL í˜¸ì¶œ"]
    MB["ğŸ§± MatchBuilder"]
    CTX["ğŸŒ¿ MatchContext"]
    EVAL["âš™ï¸ PatternEvaluator"]
    TP["ğŸ”¤ TypePattern"]
    VP["ğŸ”¢ ValuePattern"]
    DP["ğŸ“¦ DestructurePattern"]
    PC["ğŸ“ƒ PredicateCondition"]
    SS["ğŸ§¾ Snapshot ê¸°ë¡"]
    MR["âœ… PatternMatchResult"]

    User --> MB --> CTX --> EVAL
    EVAL --> TP
    EVAL --> VP
    EVAL --> DP
    EVAL --> PC
    EVAL --> SS
    EVAL --> MR

```
## ğŸ“ License


This project is licensed under the [MIT License](./LICENSE) Â© 2025 Acacian